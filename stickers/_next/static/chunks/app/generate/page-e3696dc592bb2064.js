(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[456],{5545:(e,t,n)=>{Promise.resolve().then(n.bind(n,5021))},5021:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>p});var i=n(5155),s=n(5142),r=n(3762),a=n(6743),l=n(8552),o=n(2115),c=n(639),d=n(8954),u=n(2611),g=n(1096);function h(e){let{index:t,annotation:{title:n,description:s,fillStyle:r},onChange:a,moveAnnotation:l,removeAnnotation:o}=e;return(0,i.jsx)("div",{className:"w-full bg-white shadow sm:rounded-lg",children:(0,i.jsxs)("div",{className:"px-4 py-5 sm:p-6",children:[(0,i.jsxs)("div",{className:"flex justify-between",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("span",{className:"inline-block w-5 h-5 align-text-bottom rounded",style:{backgroundColor:r}}),(0,i.jsxs)("h3",{className:"inline-block pl-2 text-base font-semibold text-gray-900",children:["Annotation #",t+1]})]}),(0,i.jsxs)("div",{className:"flex space-x-4",children:[(0,i.jsxs)("button",{type:"button",onClick:()=>l("up"),className:"text-gray-400 bg-white rounded-md hover:text-gray-500 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2",children:[(0,i.jsx)("span",{className:"sr-only",children:"Close"}),(0,i.jsx)(d.A,{"aria-hidden":"true",className:"size-6"})]}),(0,i.jsxs)("button",{type:"button",onClick:()=>l("down"),className:"text-gray-400 bg-white rounded-md hover:text-gray-500 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2",children:[(0,i.jsx)("span",{className:"sr-only",children:"Close"}),(0,i.jsx)(u.A,{"aria-hidden":"true",className:"size-6"})]}),(0,i.jsxs)("button",{type:"button",onClick:()=>o(),className:"text-gray-400 bg-white rounded-md hover:text-gray-500 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2",children:[(0,i.jsx)("span",{className:"sr-only",children:"Close"}),(0,i.jsx)(g.A,{"aria-hidden":"true",className:"size-6"})]})]})]}),(0,i.jsxs)("div",{className:"max-w-xl mt-2 text-sm text-gray-500",children:[(0,i.jsx)("div",{className:"mt-2",children:(0,i.jsx)("input",{id:"stickerName",name:"stickerName",type:"text",placeholder:"Sticker name",value:n,onChange:e=>a("title",e.target.value),className:"block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm/6"})}),(0,i.jsx)("div",{className:"mt-2",children:(0,i.jsx)("textarea",{id:"description",name:"description",placeholder:"Add the story behind your sticker here, as well as anything else you want like other people to know about it!",value:s,onChange:e=>a("description",e.target.value),className:"block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm/6",rows:4})})]})]})})}let f=["rgba(239,68,68,0.5)","rgba(234,88,12,0.5)","rgba(5,150,105,0.5)","rgba(13,148,136,0.5)","rgba(14,165,233,0.5)","rgba(139,92,246,0.5)","rgba(168,85,247,0.5)","rgba(225,29,72,0.5)","rgba(219,39,119,0.5)","rgba(232,121,249,0.5)","rgba(77,124,15,0.5)","rgba(52,211,153,0.5)","rgba(29,78,216,0.5)","rgba(255, 0, 0, 0.5)"];function m(e){let{img:t,renderAdditionalButton:n}=e,s=(0,o.useRef)(null),[r,a]=(0,o.useState)([]),[l,d]=(0,o.useState)(null),[u,g]=(0,o.useState)(null),[m,x]=(0,o.useState)(null),[y,p]=(0,o.useState)({...t}),b=(e,t)=>{p(n=>({...n,annotations:[...n.annotations,{title:"",description:"",fillStyle:t,polygon:e}]}))},v=e=>{p(t=>({...t,annotations:t.annotations.filter((t,n)=>n!==e)}))},w=e=>{p(t=>({...t,title:e}))},j=(e,t,n)=>{p(i=>({...i,annotations:i.annotations.map((i,s)=>s===e?{...i,[t]:n}:i)}))},N=(e,t)=>{let n="up"===t?e-1:e+1;n<0||n>=y.annotations.length||p(t=>{let i=[...t.annotations];return[i[e],i[n]]=[i[n],i[e]],{...t,annotations:i}})},k=e=>{if(!s.current||!l)return{x:0,y:0};let t=s.current.getBoundingClientRect();return{x:(e.clientX-t.left)*(l.canvas.width/t.width),y:(e.clientY-t.top)*(l.canvas.height/t.height)}},C=()=>{let e=document.createElement("a"),t=new Blob([JSON.stringify(y)],{type:"application/json"});e.href=URL.createObjectURL(t),e.download="annotations.json",e.click(),URL.revokeObjectURL(e.href)};(0,o.useEffect)(()=>{let e=s.current;if(!e)return;let t=e.getContext("2d");if(!t)return;let n=new Image;n.src=y.src,n.onload=()=>{e.width=n.width,e.height=n.height,t.drawImage(n,0,0,e.width,e.height),d(t),g(n)}},[y.src]);let S=(e,t)=>{let{x:n,y:i}=t,s=(0,c.UQ)(e);e.fillStyle="white",e.strokeStyle="white",e.fillRect(n-2,i-2,s,s),e.moveTo(n,i)};(0,o.useEffect)(()=>{if(!s.current||!l||!u)return;let e=(e,t,n)=>{e.lineWidth=(0,c.UQ)(e)/6,e.strokeStyle="white",e.lineCap="square",e.beginPath();let{polygon:i}=t;for(let t=0;t<i.length;t++)0==t?e.moveTo(i[t].x,i[t].y):e.lineTo(i[t].x,i[t].y),n||S(e,i[t]);n&&(e.lineTo(i[0].x,i[0].y),e.closePath(),e.fillStyle=t.fillStyle,e.fill(),e.strokeStyle="blue"),e.stroke()};for(let t of(null==l||l.drawImage(u,0,0,l.canvas.width,l.canvas.height),y.annotations))e(l,t,!0);e(l,{polygon:r,fillStyle:""},!1),(e=>{if(!m)return;S(e,m);let t=r.at(-1);t&&(console.log(t),e.lineWidth=(0,c.UQ)(e)/6,e.strokeStyle="white",e.lineCap="square",e.beginPath(),e.moveTo(m.x,m.y),e.lineTo(t.x,t.y),e.stroke())})(l)},[m,r,y.annotations,l,u]);let A=()=>{if(r.length<=2){alert("Your polygon must have at least 3 points.");return}b(r,f[y.annotations.length%f.length]),a([])},I=e=>{if(!s.current||!l)return;if(!0===e.ctrlKey){A(),e.preventDefault();return}if(2===e.button){a(r.slice(0,-1));return}let t=k(e);if(r.length>0&&t.x==r.at(-1).x&&t.y==r.at(-1).y)return;let n=(0,c.UQ)(l)+30;if(void 0!==r[0]&&(0,c.cK)(r[0],t)<n){A();return}if((0,c.UP)(r,t)){alert("The line you are drawing intersects another line in your polygon.");return}a([...r,t])},R=e=>{x(k(e))};return(0,i.jsxs)("div",{className:"flex items-center justify-center w-screen h-screen p-4 space-x-4",children:[(0,i.jsx)("div",{className:"w-3/4",children:(0,i.jsx)("canvas",{className:"w-full cursor-crosshair",ref:s,onMouseDown:e=>I(e),onContextMenu:e=>e.preventDefault(),onMouseMove:e=>R(e),onMouseLeave:()=>x(null)})}),0===y.annotations.length?(0,i.jsxs)("div",{className:"flex flex-col items-center justify-center w-1/4 h-full space-y-2 text-center",children:[(0,i.jsx)("p",{children:"Gonna be honest, this is designed for desktop. If you're on mobile, your mileage may vary."}),(0,i.jsx)("p",{children:"Click to draw a point on your image. Right-click to undo the last point. Press CTRL+click or click the first point to close your shape."}),(0,i.jsx)("p",{children:"Once you complete a shape, you'll see an annotation display here. Each annotation gets filled with a random colour."}),(0,i.jsx)("p",{children:"If you have multiple annotations, the up and down arrows can change the “layering” order. If a user clicks on an overlapping annotation, annotation earliest in the list will be read."})]}):(0,i.jsxs)("div",{className:"flex flex-col items-center w-1/4 h-full py-2 space-y-3 overflow-y-auto",children:[y.annotations.map((e,t)=>(0,i.jsx)(h,{index:t,annotation:e,moveAnnotation:e=>N(t,e),removeAnnotation:()=>v(t),onChange:(e,n)=>j(t,e,n)},t)),(0,i.jsxs)("div",{className:"w-full mt-5",children:[n&&n(),(0,i.jsx)("button",{type:"button",className:"w-full px-3 py-2 text-sm font-semibold text-white bg-indigo-600 rounded-md shadow-sm hover:bg-indigo-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600 mt-2",onClick:()=>{let e=prompt("Enter a title for this annotation. For example: 'my work MacBook'.");w(null!=e?e:"My stickers!"),C()},children:"Save annotations"})]})]})]})}var x=n(5565),y=n(6093);function p(){let[e,t]=(0,o.useState)(null),[n,c]=(0,o.useState)(!1),d=(0,o.useRef)(null),u=e=>{var n;let i=new FileReader;if(!(null===(n=e.target.files)||void 0===n?void 0:n[0])){alert("No file selected!");return}let s=e.target.files[0];if(!["image/png","image/jpeg","image/jpg"].includes(s.type)){alert("Please select a PNG or JPG/JPEG image file.");return}i.readAsDataURL(s),i.onload=e=>{var n;(null===(n=e.target)||void 0===n?void 0:n.result)&&t({src:e.target.result,title:"New Image",annotations:[]})},i.onerror=e=>{console.error(e),alert("An error occurred while reading the file.")}},g=e=>{var n;let i=new FileReader;if(!(null===(n=e.target.files)||void 0===n?void 0:n[0])){alert("No file selected!");return}i.readAsText(e.target.files[0]),i.onload=e=>{var n;if(null===(n=e.target)||void 0===n?void 0:n.result)try{let n=JSON.parse(e.target.result),i=(0,y.yi)(n);t(i)}catch(e){console.error(e),alert("An error occurred while reading the file. Please make sure it's a valid sticker annotation file.");return}},i.onerror=e=>{console.error(e),alert("An error occurred while reading the file.")}},h=n=>{var i,s;if(!e)return;let r=new FileReader;if(!(null===(i=n.target.files)||void 0===i?void 0:i[0])){alert("No file selected!");return}r.readAsDataURL(null===(s=n.target.files)||void 0===s?void 0:s[0]),r.onload=n=>{var i;if(null===(i=n.target)||void 0===i?void 0:i.result){let i=new window.Image;i.src=n.target.result,i.onload=()=>{if(!d.current)return;let n=new window.Image;n.src=e.src,n.onload=()=>{let s=d.current,r=s.getContext("2d");s.width=n.width,s.height=n.height,r.clearRect(0,0,s.width,s.height),r.drawImage(i,0,0,i.width,i.height,0,0,s.width,s.height);let a=s.toDataURL("image/png");t({...e,src:a}),c(!1)}}}},r.onerror=e=>{console.error(e),alert("An error occurred while reading the file.")}},f=()=>{c(!0)};return e?n?(0,i.jsxs)("div",{className:"flex flex-row items-center justify-center w-screen h-screen",children:[(0,i.jsxs)("div",{className:"w-4/12 space-y-3 text-center text-gray-900",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("h1",{className:"text-3xl font-semibold",children:"Replace Image"}),(0,i.jsx)("p",{children:"Update the image while keeping your annotations"})]}),(0,i.jsx)("div",{className:"flex justify-center my-4",children:(0,i.jsx)(x.default,{src:e.src,alt:"Current image",width:500,height:320,className:"max-h-80 border border-gray-300 rounded-lg",priority:!0})}),(0,i.jsx)("input",{id:"replaceImage",type:"file",accept:"image/*",onChange:e=>h(e),className:"hidden"}),(0,i.jsxs)("div",{className:"flex space-x-3 justify-center",children:[(0,i.jsx)("button",{onClick:()=>{var e;return null===(e=document.getElementById("replaceImage"))||void 0===e?void 0:e.click()},type:"button",className:"px-4 py-2 text-sm font-medium text-white bg-indigo-500 rounded-md hover:bg-indigo-600 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2",children:(0,i.jsxs)("span",{className:"flex items-center",children:[(0,i.jsx)(s.A,{className:"w-4 h-4 mr-1"}),"Select New Image"]})}),(0,i.jsx)("button",{onClick:()=>{c(!1)},type:"button",className:"px-4 py-2 text-sm font-medium text-white bg-indigo-500 rounded-md hover:bg-indigo-600 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2",children:(0,i.jsxs)("span",{className:"flex items-center",children:[(0,i.jsx)(a.A,{className:"w-4 h-4 mr-1"}),"Cancel"]})})]}),(0,i.jsx)("p",{className:"text-sm text-gray-500",children:"The new image will be automatically scaled to match the dimensions of the original."})]}),(0,i.jsx)("canvas",{ref:d,className:"hidden"})]}):(0,i.jsx)("div",{children:(0,i.jsx)(m,{img:e,renderAdditionalButton:()=>(0,i.jsx)("button",{onClick:f,type:"button",className:"w-full px-3 py-2 text-sm font-semibold text-white bg-indigo-600 rounded-md shadow-sm hover:bg-indigo-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600",children:(0,i.jsxs)("span",{className:"flex items-center justify-center",children:[(0,i.jsx)(l.A,{className:"w-4 h-4 mr-1"}),"Replace Image"]})})})}):(0,i.jsx)("div",{className:"flex flex-row items-center justify-center w-screen h-screen",children:(0,i.jsxs)("div",{className:"w-4/12 space-y-3 text-center text-gray-900",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("h1",{className:"text-3xl font-semibold",children:"Click-a-Sticker! Creator"}),(0,i.jsx)("p",{children:"Create annotated images to show off your laptop stickers! \uD83C\uDFA8"})]}),(0,i.jsx)("input",{id:"newImage",type:"file",accept:".png,.jpg,.jpeg",onChange:e=>u(e),className:"hidden"}),(0,i.jsx)("input",{id:"existingFile",type:"file",accept:"application/json",onChange:e=>g(e),className:"hidden"}),(0,i.jsxs)("div",{className:"flex space-x-2",children:[(0,i.jsxs)("button",{onClick:()=>{var e;return null===(e=document.getElementById("newImage"))||void 0===e?void 0:e.click()},type:"button",className:"relative block w-full p-12 text-center border-2 border-gray-500 border-dashed rounded-lg hover:border-gray-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2",children:[(0,i.jsx)(s.A,{className:"mx-auto text-gray-600 size-12"}),(0,i.jsx)("span",{className:"block mt-2 text-sm font-semibold text-gray-900",children:"Select an image and annotate your stickers!"})]}),(0,i.jsxs)("button",{onClick:()=>{var e;return null===(e=document.getElementById("existingFile"))||void 0===e?void 0:e.click()},type:"button",className:"relative block w-full p-12 text-center border-2 border-gray-500 border-dashed rounded-lg hover:border-gray-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2",children:[(0,i.jsx)(r.A,{className:"mx-auto text-gray-600 size-12"}),(0,i.jsx)("span",{className:"block mt-2 text-sm font-semibold text-gray-900",children:"Edit an already annotated image!"})]})]}),(0,i.jsxs)("div",{children:[(0,i.jsxs)("p",{children:["Other, better solutions to do this probably exist, but I wanted to make something from scratch to get to grips with ",(0,i.jsx)("code",{children:"canvas"}),"."]}),(0,i.jsxs)("p",{children:["Some silly little code by"," ",(0,i.jsx)("a",{href:"https://cowsay.io",className:"underline",children:"Leo"}),"."]})]})]})})}},6093:(e,t,n)=>{"use strict";n.d(t,{yi:()=>l});var i=n(3415);let s=i.z.object({x:i.z.number(),y:i.z.number()}),r=i.z.object({title:i.z.string(),description:i.z.string(),fillStyle:i.z.string(),polygon:i.z.array(s)}),a=i.z.object({src:i.z.string(),title:i.z.string(),annotations:i.z.array(r).default([])});function l(e){try{return a.parse(e)}catch(t){if(e.src&&Array.isArray(e.annotations))return a.parse({src:e.src,title:e.title||"My stickers!",annotations:e.annotations.map(e=>({title:e.title||"",description:e.description||"",fillStyle:e.fillStyle||"rgba(239,68,68,0.5)",polygon:e.polygon||[]}))});throw t}}},639:(e,t,n)=>{"use strict";n.d(t,{UP:()=>r,UQ:()=>a,cK:()=>s});let i=(e,t,n,i)=>{let s=t.x-e.x,r=t.y-e.y,a=i.x-n.x,l=i.y-n.y,o=(-r*(e.x-n.x)+s*(e.y-n.y))/(-a*r+s*l),c=(a*(e.y-n.y)-l*(e.x-n.x))/(-a*r+s*l);return o>=0&&o<=1&&c>=0&&c<=1},s=(e,t)=>Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2)),r=(e,t)=>{if(e.length<3)return!1;let n={x:0,y:0},s={x:0,y:0},r={...e.at(-1)},a={...t};for(let t=0;t<e.length-1;t++)if(n={...e[t]},((s={...e[t+1]}).x!==r.x||s.y!==r.y)&&(n.x!==a.x||n.y!==a.y)&&i(n,s,r,a))return!0;return!1},a=e=>Math.round(e.canvas.height/100)}},e=>{var t=t=>e(e.s=t);e.O(0,[729,692,441,517,358],()=>t(5545)),_N_E=e.O()}]);